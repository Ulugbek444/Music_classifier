# Music Classifier & LyricMood Bot

–ü—Ä–æ–µ–∫—Ç –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç FastAPI-—Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è —Ä–µ—á–∏ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —ç–º–æ—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞ —Å Telegram-–±–æ—Ç–æ–º, –∫–æ—Ç–æ—Ä—ã–π –∏—â–µ—Ç —Ç–µ–∫—Å—Ç—ã –ø–µ—Å–µ–Ω, –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∏—Ö –∏ —Å–æ–æ–±—â–∞–µ—Ç –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—â—É—é —ç–º–æ—Ü–∏—é –ª–∏—Ä–∏—á–µ—Å–∫–æ–≥–æ –≥–µ—Ä–æ—è.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **ML_API** ‚Äî FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –¥–≤—É–º—è —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏:
  - `POST /transcribe` ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∞ –∞—É–¥–∏–æ—Ñ–∞–π–ª–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ —á–µ—Ä–µ–∑ Whisper.
  - `POST /predict-emotion` ‚Äî –ø—Ä–∏—ë–º —Ç–µ–∫—Å—Ç–∞ –∏ –≤—ã–¥–∞—á–∞ —ç–º–æ—Ü–∏–∏ (`joy`, `sadness`, `anger`, `fear`, `love`, `surprise`) —Å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å—é –º–æ–¥–µ–ª–∏ `Ulugbek444/Music_classifier`.
- **bot** ‚Äî Telegram-–±–æ—Ç –Ω–∞ aiogram 3:
  - –ü—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏ –≥–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
  - –î–ª—è —Ç–µ–∫—Å—Ç–∞ –∏–ª–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏ –≥–æ–ª–æ—Å–∞ –∏—â–µ—Ç –ø–µ—Å–Ω—é –≤ Genius API, –ø–∞—Ä—Å–∏—Ç –µ—ë —Ç–µ–∫—Å—Ç –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ ML_API –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —ç–º–æ—Ü–∏–∏.
  - –û—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –Ω–∞–∑–≤–∞–Ω–∏–µ–º –ø–µ—Å–Ω–∏, —ç–º–æ—Ü–∏–µ–π –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –ø—Ä–æ–≥–Ω–æ–∑–æ–≤.
- **docker-compose.yml** ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç –±–æ—Ç–∞ —Å ML_API –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Docker –∏ Docker Compose (–¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–∞–ø—É—Å–∫–∞) –∏–ª–∏ Python 3.10+ (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞).
- –¢–æ–∫–µ–Ω—ã –¥–æ—Å—Ç—É–ø–∞:
  - `BOT_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω Telegram-–±–æ—Ç–∞.
  - `GENIUS_TOKEN` ‚Äî —Ç–æ–∫–µ–Ω –¥–ª—è Genius API.
  - `ML_API_BASE` ‚Äî –±–∞–∑–æ–≤—ã–π URL ML_API (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `http://localhost:8000`).

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –≤ Docker
1. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
   ```env
   BOT_TOKEN=–≤–∞—à_telegram_token
   GENIUS_TOKEN=–≤–∞—à_genius_token
   ML_API_BASE=http://whisper-api:8000
   ```
2. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–∏—Å—ã:
   ```bash
   docker-compose up --build
   ```
3. ML_API —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `http://localhost:8000`, –±–æ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ –Ω–µ–º—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

## –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ Docker
1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ ML_API:
   ```bash
   pip install -r ML_API/requirements.txt
   ```
2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ ML_API:
   ```bash
   uvicorn ML_API.whisper_api:app --host 0.0.0.0 --port 8000
   ```
3. –í –æ—Ç–¥–µ–ª—å–Ω–æ–π –∫–æ–Ω—Å–æ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –±–æ—Ç–∞:
   ```bash
   pip install -r bot/requirements.txt
   ```
4. –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ `.env`) –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ `.env` –≤ –∫–∞—Ç–∞–ª–æ–≥–µ `bot`, –∑–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞:
   ```bash
   python -m bot.app
   ```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API
### –†–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –∞—É–¥–∏–æ
```bash
curl -X POST \
  -F "file=@voice.ogg" \
  http://localhost:8000/transcribe
```
–û—Ç–≤–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–ª–µ `text` —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π Whisper.

### –ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ —ç–º–æ—Ü–∏–∏
```bash
curl -X POST \
  -H "Content-Type: application/json" \
  -d '{"text": "We will rock you"}' \
  http://localhost:8000/predict-emotion
```
–û—Ç–≤–µ—Ç –≤–∫–ª—é—á–∞–µ—Ç `emotion` –∏ `confidence` (–≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏).

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞
- `ML_API/whisper_api.py` ‚Äî FastAPI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ, –∑–∞–≥—Ä—É–∑–∫–∞ Whisper –∏ —ç–º–æ-–º–æ–¥–µ–ª–∏, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤.
- `bot/tg_bot.py` ‚Äî –º–∞—Ä—à—Ä—É—Ç—ã –±–æ—Ç–∞: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –∏ –≥–æ–ª–æ—Å–æ–≤—ã—Ö, –≤—ã–∑–æ–≤ Genius API –∏ ML_API.
- `bot/genius_api/` ‚Äî –ø–æ–∏—Å–∫ –ø–µ—Å–µ–Ω –∏ –ø–∞—Ä—Å–∏–Ω–≥ —Ç–µ–∫—Å—Ç–∞.
- `docker-compose.yml` ‚Äî –∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π.

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- Whisper –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ `small` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ ML_API.
- –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç–æ–∫–µ–Ω–∏–∑–∞—Ç–æ—Ä –∏ –≤–µ—Å–∞ Hugging Face; –∏–Ω—Ñ–µ—Ä–µ–Ω—Å –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ä–µ–∂–∏–º–µ `eval` —Å `torch.no_grad()`.
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å—Ç–∏–∫–µ—Ä –∏ inline-–∫–Ω–æ–ø–∫–∏ –ø—Ä–∏ –≤—Ç–æ—Ä–æ–º —É—Å–ø–µ—à–Ω–æ–º –∞–Ω–∞–ª–∏–∑–µ.

## üìä –ö–∞—á–µ—Å—Ç–≤–æ –º–æ–¥–µ–ª–∏

–ú–æ–¥–µ–ª—å –±—ã–ª–∞ –æ—Ü–µ–Ω–µ–Ω–∞ –Ω–∞ –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–µ –ø–æ—Å–ª–µ –¥–æ–æ–±—É—á–µ–Ω–∏—è.

### –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏
- **Accuracy (—Ç–æ—á–Ω–æ—Å—Ç—å)**: `63.4%`
- **Macro F1-score**: `0.635`
- **Weighted F1-score**: `0.634`
- **–ó–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ—Ç–µ—Ä—å (loss)**: `1.04`
- **–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–ø–æ—Ö –æ–±—É—á–µ–Ω–∏—è**: `1`

### –°–∫–æ—Ä–æ—Å—Ç—å –æ—Ü–µ–Ω–∫–∏
- **–ü—Ä–∏–º–µ—Ä–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É**: ~`255`
- **–®–∞–≥–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É**: ~`31.8`
- **–û–±—â–µ–µ –≤—Ä–µ–º—è –æ—Ü–µ–Ω–∫–∏**: ~`55 —Å–µ–∫—É–Ω–¥`

---

### –ö–∞—á–µ—Å—Ç–≤–æ –ø–æ –∫–ª–∞—Å—Å–∞–º

| –≠–º–æ—Ü–∏—è   | Precision | Recall | F1-score | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–º–µ—Ä–æ–≤ |
|----------|----------:|-------:|---------:|--------------------:|
| Anger    |      0.53 |   0.64 |     0.58 |               2,371 |
| Fear     |      0.67 |   0.62 |     0.65 |               2,080 |
| Joy      |      0.67 |   0.58 |     0.62 |               3,780 |
| Love     |      0.66 |   0.73 |     0.69 |               2,043 |
| Sadness  |      0.65 |   0.65 |     0.65 |               3,150 |
| Surprise |      0.65 |   0.59 |     0.62 |                 497 |

**Macro-—Å—Ä–µ–¥–Ω–∏–π F1**: `0.63`  
**Weighted-—Å—Ä–µ–¥–Ω–∏–π F1**: `0.63`

---

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ –æ—Ü–µ–Ω–∫–µ
- –ù–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö –æ–±–ª–∞–¥–∞–µ—Ç **–¥–∏—Å–±–∞–ª–∞–Ω—Å–æ–º –∫–ª–∞—Å—Å–æ–≤**, –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è —ç–º–æ—Ü–∏–∏ `surprise`.
- –ú–µ—Ç—Ä–∏–∫–∞ **Macro F1** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å –¥–ª—è –±–æ–ª–µ–µ –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –∫–∞—á–µ—Å—Ç–≤–∞ –ø–æ –≤—Å–µ–º –∫–ª–∞—Å—Å–∞–º.
- –õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞–±–ª—é–¥–∞–µ—Ç—Å—è –¥–ª—è —ç–º–æ—Ü–∏–π **love**, **fear** –∏ **sadness**, –Ω–µ–º–Ω–æ–≥–æ –Ω–∏–∂–µ ‚Äî –¥–ª—è **anger** –∏ **surprise**.
